#!/usr/bin/env python

from argparse import ArgumentParser
from setup import Setup
from ui import input_bool
from utils import rel_path
from specification import Specification

parser = ArgumentParser(description='Declerative Arch Linux installer')
parser.add_argument('file', help='Specification file')
parser.add_argument(
    '-c',
    action='store_const',
    const=True,
    default=False,
    help='Check with specification',
)
args = parser.parse_args()

try:
    spec = Specification.from_file(args.file)
    if args.c: exit(spec.check())
    setup = Setup(spec, rel_path('dist'))
    setup.input_missing()
    setup.write_dist()
    if input_bool('Run'): setup.run()
except KeyboardInterrupt:
    print('Interrupt')
